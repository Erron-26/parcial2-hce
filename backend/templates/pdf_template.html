<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Historia Clínica - {{ paciente.primer_nombre }} {{ paciente.primer_apellido }}</title>
    <style>
        @page {
            size: A4;
            margin: 1.5cm;
        }
        body { font-family: 'DejaVu Sans', sans-serif; font-size: 10pt; line-height: 1.4; }
        h1, h2, h3 { color: #2c3e50; font-weight: bold; }
        h1 { text-align: center; margin-bottom: 1cm; font-size: 18pt; }
        h2 { border-bottom: 2px solid #3498db; padding-bottom: 8px; margin-top: 1.2cm; margin-bottom: 0.8cm; font-size: 14pt; }
        h3 { color: #34495e; margin-top: 1cm; font-size: 12pt; }
        .section { margin-bottom: 1cm; }
        .data-grid { display: block; }
        .data-row { display: block; margin-bottom: 6px; }
        .data-item { display: inline-block; width: 48%; vertical-align: top; margin-bottom: 5px; }
        .data-item label { font-weight: bold; margin-right: 5px; color: #555; }
        .full-width { width: 100%; }
        .attention-item { border: 1px solid #bdc3c7; padding: 15px; margin-bottom: 15px; border-radius: 5px; background-color: #fdfdfd; page-break-inside: avoid; }
        .attention-header { border-bottom: 1px solid #ecf0f1; padding-bottom: 10px; margin-bottom: 10px; }
        .attention-header h3 { margin-top: 0; font-size: 12pt; display: inline-block; }
        .attention-header span { float: right; color: #7f8c8d; font-size: 9pt; }
        .details-section { margin-top: 10px; }
        .details-section h4 { font-size: 10pt; color: #2980b9; border-bottom: 1px solid #ecf0f1; padding-bottom: 3px; margin-top: 15px; margin-bottom: 5px; }
        .details-section p { margin: 0 0 5px 10px; }
        .page-break { page-break-before: always; }
    </style>
</head>
<body>
    <h1>Historia Clínica Electrónica</h1>

    <div class="section">
        <h2>Datos del Paciente</h2>
        <div class="data-grid">
            <div class="data-row">
                <div class="data-item full-width"><label>Nombre Completo:</label> {{ paciente.primer_nombre }} {{ paciente.segundo_nombre or '' }} {{ paciente.primer_apellido }} {{ paciente.segundo_apellido or '' }}</div>
            </div>
            <div class="data-row">
                <div class="data-item"><label>Identificación:</label> {{ paciente.tipo_documento }} {{ paciente.documento_id }}</div>
                <div class="data-item"><label>Fecha de Nacimiento:</label> {{ paciente.fecha_nacimiento }} (Edad: {{ paciente.edad }})</div>
            </div>
            <div class="data-row">
                <div class="data-item"><label>Sexo:</label> {{ paciente.sexo or 'N/A' }}</div>
                <div class="data-item"><label>Género:</label> {{ paciente.genero or 'N/A' }}</div>
            </div>
            <div class="data-row">
                <div class="data-item"><label>Estado Civil:</label> {{ paciente.estado_civil or 'N/A' }}</div>
                 <div class="data-item"><label>Ocupación:</label> {{ paciente.ocupacion or 'N/A' }}</div>
            </div>
             <div class="data-row">
                <div class="data-item"><label>Grupo Sanguíneo/RH:</label> {{ paciente.grupo_sanguineo or 'N/A' }}{{ paciente.factor_rh or '' }}</div>
            </div>
            <div class="data-row">
                 <div class="data-item full-width"><label>Dirección:</label> {{ paciente.direccion_residencia or 'N/A' }}, {{ paciente.municipio_ciudad or 'N/A' }}, {{ paciente.departamento or 'N/A' }}</div>
            </div>
            <div class="data-row">
                <div class="data-item"><label>Teléfono:</label> {{ paciente.telefono or 'N/A' }}</div>
                <div class="data-item"><label>Celular:</label> {{ paciente.celular or 'N/A' }}</div>
            </div>
             <div class="data-row">
                <div class="data-item full-width"><label>Correo Electrónico:</label> {{ paciente.correo_electronico or 'N/A' }}</div>
            </div>
            <div class="data-row">
                <div class="data-item"><label>Entidad de Afiliación:</label> {{ paciente.entidad_afiliacion or 'N/A' }}</div>
                <div class="data-item"><label>Régimen:</label> {{ paciente.regimen_afiliacion or 'N/A' }}</div>
            </div>
        </div>
    </div>

    <div class="section">
        <h2>Historial de Atenciones</h2>
        {% if atenciones %}
            {% for atencion in atenciones %}
                <div class="attention-item">
                    <div class="attention-header">
                        <h3>{{ atencion.tipo_atencion }}</h3>
                        <span>{{ atencion.fecha_hora_atencion.strftime('%Y-%m-%d %H:%M') }}</span>
                    </div>
                    <div class="details-section">
                        <h4>Motivo de Consulta</h4>
                        <p>{{ atencion.motivo_consulta or 'No registrado' }}</p>

                        <h4>Enfermedad Actual</h4>
                        <p>{{ atencion.enfermedad_actual or 'No registrado' }}</p>

                        <h4>Antecedentes</h4>
                        <div class="data-item"><label>Personales:</label> {{ atencion.antecedentes_personales or 'N/A' }}</div>
                        <div class="data-item"><label>Familiares:</label> {{ atencion.antecedentes_familiares or 'N/A' }}</div>
                        <div class="data-item"><label>Alergias:</label> {{ atencion.alergias_conocidas or 'N/A' }}</div>
                        <div class="data-item"><label>Medicamentos Actuales:</label> {{ atencion.medicamentos_actuales or 'N/A' }}</div>

                        <h4>Examen Físico y Signos Vitales</h4>
                         <p>
                            {% if atencion.signos_vitales %}
                                {% for key, value in atencion.signos_vitales.items() %}
                                    <strong>{{ key }}:</strong> {{ value }}{% if not loop.last %}, {% endif %}
                                {% endfor %}
                            {% else %}
                                Signos vitales no registrados.
                            {% endif %}
                        </p>
                        <p><label>Ex. General:</label> {{ atencion.examen_fisico_general or 'N/A' }}</p>
                        <p><label>Ex. por Sistemas:</label> {{ atencion.examen_fisico_por_sistemas or 'N/A' }}</p>
                        

                        <h4>Diagnóstico y Plan</h4>
                        <div class="data-item full-width"><label>Impresión Diagnóstica:</label> {{ atencion.impresion_diagnostica or 'N/A' }}</div>
                        <div class="data-item"><label>CIE10:</label> {{ atencion.codigos_cie10 | join(', ') if atencion.codigos_cie10 else 'N/A' }}</div>
                        <div class="data-item full-width"><label>Plan de Manejo:</label> {{ atencion.conducta_plan_manejo or 'N/A' }}</div>
                        
                        {% if atencion.profesional_responsable_nombre %}
                            <div class="data-item full-width" style="margin-top: 15px;"><label>Profesional Responsable:</label> {{ atencion.profesional_responsable_nombre }}</div>
                        {% endif %}
                    </div>
                </div>
            {% endfor %}
        {% else %}
            <p>No se encontraron atenciones registradas para este paciente.</p>
        {% endif %}
    </div>

</body>
</html>

